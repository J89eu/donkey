# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include extras/*]
[include config_backup.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_240015001951333031373837-if00

[printer]
kinematics: cartesian
max_velocity: 1200 
max_accel: 60000
max_z_velocity: 75 
max_z_accel: 2000
square_corner_velocity: 20
   
[input_shaper]
shaper_freq_x: 90.4
shaper_type_x: mzv
shaper_freq_y: 105.4
shaper_type_y: mzv

[heater_bed]
heater_pin: PA3
sensor_pin: PF3
sensor_type: Generic 3950
max_power: 1.0
min_temp: 0
max_temp: 160
#control: watermark
#max_delta: 0.5

# Mesh Bed Settings
[bed_mesh]
speed: 425
horizontal_move_z: 1
mesh_min: 20,25
mesh_max: 150, 155
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: .01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
adaptive_margin: 5

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right
points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
speed: 500
horizontal_move_z: 5.0
retries: 8
retry_tolerance: 0.005

# Motor and Heater Idle Timeout
[idle_timeout]
# only turn off motors and heaters if the printer is not paused
gcode:
    {% if not (printer.pause_resume.is_paused) %}
        TURN_OFF_HEATERS
        M84
        SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber TARGET=0

    {% endif %}
timeout: 1200

[led my_led]
white_pin: PD13
cycle_time: 0.010
hardware_pwm: False
initial_WHITE: 0.2

[gcode_macro LED_ON]
gcode:
    SET_LED LED=my_led WHITE=0.2
    SET_GCODE_VARIABLE MACRO=led_state VARIABLE=active VALUE=1
    UPDATE_DELAYED_GCODE ID=led_timer DURATION=1800  # 30 minutes

[gcode_macro LED_OFF]
gcode:
    SET_LED LED=my_led WHITE=0.0
    SET_GCODE_VARIABLE MACRO=led_state VARIABLE=active VALUE=0

[delayed_gcode led_timer]
gcode:
    {% if printer["led_state"].active %}
    LED_OFF
    {% endif %}

[gcode_macro led_state]
variable_active: 0
gcode:
    ; No action needed, this just holds variables

[delayed_gcode led_timer]
gcode:
    {% if not printer["print_status"].printing %}
    LED_OFF
    {% else %}
    UPDATE_DELAYED_GCODE ID=led_timer DURATION=300  # check again in 5 minutes
    {% endif %}

[gcode_macro _PRINTER_INIT]
gcode:
    LED_ON

[delayed_gcode __printer_init]
initial_duration: 5
gcode:
    _PRINTER_INIT

[gcode_macro print_status]
variable_printing: False
gcode:
    ; Used for tracking print state only

# Enable stuff
[virtual_sdcard]
path: ~/printer_data/gcodes

[force_move]
enable_force_move: true

[pause_resume]

[display_status]

[respond]

[exclude_object]

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 52.222
#*# pid_ki = 2.959
#*# pid_kd = 230.431
#*# control = pid
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.004787, 0.015966, 0.022478, 0.024716, 0.027197, 0.030485, 0.029005, 0.029839, 0.033177, 0.033797, 0.030540, 0.028638, 0.026251, 0.022459, 0.020323, 0.022643, 0.023514, 0.023559, 0.021903, 0.019186, 0.012327, 0.005821, 0.002757, 0.001439, 0.015034
#*# 	  -0.006462, 0.020008, 0.029434, 0.029971, 0.034442, 0.038677, 0.038675, 0.037077, 0.042478, 0.042967, 0.037031, 0.033297, 0.031246, 0.030431, 0.028169, 0.031361, 0.032420, 0.030317, 0.027390, 0.027468, 0.022722, 0.020667, 0.010497, 0.007444, 0.022744
#*# 	  -0.005564, 0.016199, 0.026152, 0.033543, 0.037639, 0.040427, 0.042018, 0.041102, 0.044452, 0.045928, 0.039937, 0.036281, 0.032135, 0.030687, 0.031648, 0.030887, 0.034831, 0.036051, 0.031593, 0.032141, 0.027960, 0.020797, 0.017793, 0.005067, 0.018118
#*# 	  -0.005804, 0.018512, 0.021635, 0.027954, 0.036710, 0.034123, 0.036557, 0.037148, 0.043204, 0.042008, 0.032991, 0.030515, 0.024375, 0.025082, 0.032293, 0.030400, 0.031450, 0.035234, 0.036024, 0.033962, 0.028265, 0.017386, 0.013213, 0.002225, 0.019256
#*# 	  -0.011987, 0.012622, 0.019501, 0.027112, 0.031356, 0.035533, 0.039188, 0.041836, 0.045076, 0.037423, 0.033420, 0.029990, 0.026471, 0.026573, 0.028227, 0.034581, 0.036817, 0.039021, 0.034933, 0.028619, 0.026423, 0.015728, 0.016174, 0.007679, 0.018219
#*# 	  -0.019805, 0.011842, 0.019182, 0.021852, 0.025769, 0.030655, 0.039533, 0.039660, 0.035541, 0.030231, 0.026521, 0.027623, 0.025284, 0.020778, 0.018186, 0.024447, 0.022845, 0.029265, 0.020695, 0.018327, 0.017513, 0.010947, 0.009140, 0.008462, 0.016709
#*# 	  -0.017652, 0.017955, 0.026393, 0.030667, 0.031599, 0.035287, 0.039632, 0.037879, 0.031253, 0.033196, 0.025724, 0.022438, 0.027077, 0.022770, 0.022463, 0.018742, 0.021928, 0.024486, 0.020415, 0.021335, 0.014553, 0.007256, 0.004867, 0.004377, 0.008652
#*# 	  -0.016504, 0.016510, 0.028625, 0.032739, 0.034611, 0.037101, 0.040271, 0.035977, 0.035959, 0.034702, 0.031296, 0.022177, 0.023645, 0.018796, 0.023421, 0.022016, 0.024997, 0.023066, 0.023301, 0.020259, 0.009390, -0.001796, 0.002342, -0.006760, 0.006822
#*# 	  -0.010286, 0.015224, 0.024411, 0.033995, 0.035966, 0.039865, 0.038858, 0.037223, 0.038639, 0.038925, 0.035699, 0.032432, 0.023760, 0.022759, 0.026091, 0.023382, 0.025890, 0.026167, 0.021367, 0.015836, 0.005415, -0.001925, -0.006997, -0.003260, 0.009360
#*# 	  -0.016326, 0.005768, 0.017051, 0.025653, 0.032476, 0.036902, 0.037404, 0.037374, 0.038265, 0.038249, 0.027806, 0.027624, 0.030445, 0.026120, 0.025651, 0.024634, 0.026288, 0.025759, 0.024212, 0.016528, 0.006144, -0.004855, -0.010587, -0.017174, 0.011153
#*# 	  -0.018044, 0.010612, 0.019199, 0.016611, 0.025585, 0.035304, 0.036146, 0.034625, 0.038577, 0.041120, 0.035568, 0.030328, 0.032193, 0.028239, 0.027205, 0.024347, 0.023641, 0.021829, 0.019961, 0.011991, 0.004977, 0.001285, -0.007755, -0.013786, 0.008308
#*# 	  -0.007678, 0.011797, 0.019561, 0.020214, 0.029368, 0.036393, 0.037563, 0.041112, 0.042914, 0.041991, 0.036970, 0.034878, 0.031419, 0.027122, 0.030038, 0.030196, 0.028882, 0.027572, 0.020135, 0.010272, 0.006371, 0.004572, -0.005684, -0.011452, 0.008896
#*# 	  -0.000689, 0.018213, 0.023485, 0.023924, 0.024567, 0.035561, 0.039275, 0.045189, 0.047731, 0.049308, 0.041244, 0.036996, 0.035901, 0.035994, 0.036247, 0.030764, 0.029676, 0.028971, 0.023234, 0.017956, 0.012083, 0.010141, 0.000968, -0.009153, 0.012104
#*# 	  0.000264, 0.012249, 0.020926, 0.026258, 0.032010, 0.035705, 0.041733, 0.050458, 0.054661, 0.053270, 0.043875, 0.041997, 0.043464, 0.047864, 0.042122, 0.034276, 0.031824, 0.034303, 0.029835, 0.023023, 0.016407, 0.010981, 0.003614, -0.001387, 0.020593
#*# 	  -0.004920, 0.006044, 0.020365, 0.028892, 0.031924, 0.041131, 0.048546, 0.054949, 0.057917, 0.049256, 0.044401, 0.048382, 0.048098, 0.045414, 0.038936, 0.037635, 0.038068, 0.038459, 0.032414, 0.029555, 0.024460, 0.014840, 0.009005, 0.007960, 0.026000
#*# 	  -0.010803, 0.004298, 0.012244, 0.025045, 0.032630, 0.040242, 0.048772, 0.051990, 0.057795, 0.044966, 0.042729, 0.045239, 0.051578, 0.041426, 0.034859, 0.037355, 0.040107, 0.036164, 0.036366, 0.029779, 0.016456, 0.012170, 0.001093, -0.005618, 0.015530
#*# 	  -0.018758, 0.003845, 0.005423, 0.017812, 0.028544, 0.036098, 0.045176, 0.052820, 0.046126, 0.042442, 0.046754, 0.045548, 0.046658, 0.042339, 0.035251, 0.036055, 0.039064, 0.036258, 0.037171, 0.024837, 0.010107, 0.009992, 0.001329, -0.007140, 0.011271
#*# 	  -0.025451, -0.005383, 0.007141, 0.017312, 0.022174, 0.035227, 0.041090, 0.050290, 0.048924, 0.041821, 0.044219, 0.044734, 0.035444, 0.031730, 0.025266, 0.031174, 0.037137, 0.038082, 0.028899, 0.017882, 0.008396, 0.003351, -0.004804, -0.013005, 0.000500
#*# 	  -0.035398, -0.014100, -0.004878, 0.006930, 0.017465, 0.033709, 0.036551, 0.036373, 0.042920, 0.043969, 0.041428, 0.039609, 0.030991, 0.025265, 0.024620, 0.025334, 0.033304, 0.038127, 0.025458, 0.012220, 0.001174, 0.000511, -0.001771, -0.010178, 0.002145
#*# 	  -0.043585, -0.022390, -0.010747, 0.003522, 0.008307, 0.026343, 0.026715, 0.030418, 0.034952, 0.037251, 0.032763, 0.031304, 0.028463, 0.021649, 0.027882, 0.029447, 0.026120, 0.032409, 0.026231, 0.014154, 0.001610, -0.005788, -0.008479, -0.007327, 0.008633
#*# 	  -0.048491, -0.028066, -0.018592, -0.001856, 0.005488, 0.018547, 0.026070, 0.031963, 0.030439, 0.028356, 0.029045, 0.024547, 0.018785, 0.017989, 0.020492, 0.024690, 0.021837, 0.022515, 0.018057, 0.012331, -0.000934, -0.002574, -0.006694, -0.012277, -0.004048
#*# 	  -0.054269, -0.036557, -0.027630, -0.010991, 0.000440, 0.008065, 0.021589, 0.024869, 0.020214, 0.019808, 0.016733, 0.013331, 0.009740, 0.010534, 0.006610, 0.013644, 0.013043, 0.005014, -0.003042, 0.000857, -0.010306, -0.009256, -0.010850, -0.011410, -0.001968
#*# 	  -0.062226, -0.042372, -0.033487, -0.018758, -0.008759, -0.001115, 0.007479, 0.012778, 0.013274, 0.009594, 0.006475, 0.002492, -0.001384, -0.003423, -0.005985, -0.000095, 0.003362, -0.004509, -0.006758, -0.010263, -0.013243, -0.016515, -0.016914, -0.016882, -0.002537
#*# 	  -0.065740, -0.047558, -0.037295, -0.024823, -0.013425, -0.006708, -0.000457, 0.004695, 0.004441, 0.000201, -0.002177, -0.004966, -0.007670, -0.008775, -0.008318, -0.000263, 0.002147, -0.002513, -0.003775, -0.017085, -0.014045, -0.020267, -0.020897, -0.008992, -0.011514
#*# 	  -0.069447, -0.048103, -0.040859, -0.027045, -0.016365, -0.008679, -0.001477, 0.001173, 0.002731, -0.001202, -0.001543, -0.003217, -0.005434, -0.005988, -0.003404, -0.003823, -0.003646, -0.002692, -0.005197, -0.013913, -0.009936, -0.011542, -0.013683, -0.018205, 0.015590
#*# tension = 0.2
#*# min_x = 20.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 25.0
#*# x_count = 25
#*# max_y = 155.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.460380706674656,
#*# 	  1.7768396548272445,
#*# 	  0.7429785711061782,
#*# 	  0.29115818068612725,
#*# 	  0.333817328006318,
#*# 	  0.5319793517321809,
#*# 	  -0.11984561625127706,
#*# 	  -0.47196110828988025,
#*# 	  0.18334261932150636,
#*# 	  0.2740014758485304
#*# model_domain = 3.1706885086594e-07,3.336155072044324e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 98.074665
#*# model_offset = 0.00000
